# Module Project Filtering Guide

## üéØ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏∏‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏• (30 ‡πÇ‡∏°‡∏î‡∏π‡∏•) ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° `selectedProjectId` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö non-Super Admin

---

## üìã ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### **‚úÖ ‡πÅ‡∏Å‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß (5 ‡πÇ‡∏°‡∏î‡∏π‡∏•):**
1. ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (`/companies`) - Super Admin only
2. ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (`/projects`) - Filter by selectedProjectId
3. ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (`/user-management`) - Filter users/companies/projects
4. ‚úÖ ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (`/user-groups`) - Filter users in group assignment
5. ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô (`/team-management`) - (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)

### **‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (25+ ‡πÇ‡∏°‡∏î‡∏π‡∏•):**

#### **‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å:**
- [ ] ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î (`/dashboard`)
- [ ] ‡∏´‡πâ‡∏≠‡∏á‡∏ä‡∏∏‡∏î (`/units`)
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® (`/announcements`)
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (`/maintenance`)
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏•‡∏π‡∏Å‡∏ö‡πâ‡∏≤‡∏ô (`/resident-accounts`)
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (`/notifications`)
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏ (`/parcels`)
- [ ] ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏û‡∏±‡∏™‡∏î‡∏∏ (`/parcels/reports`)

#### **‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô:**
- [ ] ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (`/income-expenses`)
- [ ] ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á (`/common-fees`)
- [ ] ‡∏ö‡∏¥‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á (`/billing`)
- [ ] ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (`/payments`)
- [ ] ‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô (`/funds`)
- [ ] ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (`/budgets`)
- [ ] ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ (`/accounts-payable`)
- [ ] ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ (`/accounts-receivable`)

#### **‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô:**
- [ ] ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (`/financial-reports`)
- [ ] ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ä‡∏∏‡∏î (`/unit-reports`)
- [ ] ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (`/payment-reports`)
- [ ] ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (`/maintenance-reports`)

#### **‡∏≠‡∏∑‡πà‡∏ô‡πÜ:**
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (`/documents`)
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ç‡∏ç‡∏≤ (`/contracts`)
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ (`/parking`)
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á (`/facilities`)
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (`/visitors`)

---

## üîß Template ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•

### **Step 1: Import Project Context**

```tsx
// app/(admin)/[module]/page.tsx
import { useProjectContext } from "@/lib/contexts/project-context"

export default function ModulePage() {
  const { selectedProjectId, selectedProject } = useProjectContext()
  const currentUser = getCurrentUser()
  
  // ... rest of code
}
```

### **Step 2: Filter Data on Load**

```tsx
const loadData = async () => {
  const result = await getModuleData(currentUserId)
  
  if (result.success) {
    let filteredData = result.data || []
    
    // Filter by selected project (for non-Super Admin)
    if (selectedProjectId && currentUser.role !== 'super_admin') {
      filteredData = filteredData.filter(item => 
        item.project_id === selectedProjectId
      )
    }
    
    setData(filteredData)
  }
}
```

### **Step 3: Reload on Project Change**

```tsx
useEffect(() => {
  loadData()
}, [selectedProjectId])  // ‚úÖ Add dependency
```

### **Step 4: Filter on Create/Update**

```tsx
const handleCreate = async () => {
  const result = await createItem(currentUserId, {
    ...formData,
    project_id: selectedProjectId  // ‚úÖ Add project_id
  })
}
```

---

## üìù ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 1: ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ä‡∏∏‡∏î (Units)**

```tsx
// app/(admin)/units/page.tsx
"use client"

import { useState, useEffect } from "react"
import { useProjectContext } from "@/lib/contexts/project-context"
import { getCurrentUser } from "@/lib/utils/mock-auth"
import { getUnits } from "@/lib/actions/unit-actions"

export default function UnitsPage() {
  const [units, setUnits] = useState([])
  const currentUser = getCurrentUser()
  const { selectedProjectId } = useProjectContext()
  
  const loadData = async () => {
    const result = await getUnits(currentUserId, selectedProjectId)  // ‚úÖ Pass projectId
    
    if (result.success) {
      setUnits(result.units || [])
    }
  }
  
  useEffect(() => {
    loadData()
  }, [selectedProjectId])  // ‚úÖ Reload on change
  
  return (
    <div>
      <h1>‡∏´‡πâ‡∏≠‡∏á‡∏ä‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: {selectedProject?.name}</h1>
      {/* ... */}
    </div>
  )
}
```

### **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 2: ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (Maintenance)**

```tsx
// app/(admin)/maintenance/page.tsx
"use client"

import { useProjectContext } from "@/lib/contexts/project-context"

export default function MaintenancePage() {
  const [tickets, setTickets] = useState([])
  const { selectedProjectId } = useProjectContext()
  const currentUser = getCurrentUser()
  
  const loadData = async () => {
    const result = await getMaintenanceTickets(currentUserId)
    
    if (result.success) {
      let filteredTickets = result.tickets || []
      
      // Filter by project
      if (selectedProjectId && currentUser.role !== 'super_admin') {
        filteredTickets = filteredTickets.filter(ticket => 
          ticket.project_id === selectedProjectId
        )
      }
      
      setTickets(filteredTickets)
    }
  }
  
  useEffect(() => {
    loadData()
  }, [selectedProjectId])
  
  return <div>{/* ... */}</div>
}
```

---

## üóÑÔ∏è Database Schema Requirement

‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ `project_id`:

```sql
-- Example: units table
ALTER TABLE units ADD COLUMN IF NOT EXISTS project_id UUID REFERENCES projects(id);

-- Example: maintenance_tickets table
ALTER TABLE maintenance_tickets ADD COLUMN IF NOT EXISTS project_id UUID REFERENCES projects(id);

-- Example: announcements table
ALTER TABLE announcements ADD COLUMN IF NOT EXISTS project_id UUID REFERENCES projects(id);

-- Add index for performance
CREATE INDEX IF NOT EXISTS idx_units_project_id ON units(project_id);
CREATE INDEX IF NOT EXISTS idx_maintenance_project_id ON maintenance_tickets(project_id);
CREATE INDEX IF NOT EXISTS idx_announcements_project_id ON announcements(project_id);
```

---

## üîê Server Actions Pattern

### **Before (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á):**
```typescript
export async function getUnits(userId: string) {
  const { data } = await supabase
    .from('units')
    .select('*')
  
  return { units: data }  // ‚ùå ‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á
}
```

### **After (‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£):**
```typescript
export async function getUnits(userId: string, projectId?: string) {
  let query = supabase
    .from('units')
    .select('*')
  
  // Filter by project (if not Super Admin)
  if (projectId) {
    query = query.eq('project_id', projectId)
  }
  
  const { data } = await query
  
  return { units: data }  // ‚úÖ ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
}
```

---

## üìä Priority List

### **High Priority (‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢):**
1. üî• ‡∏´‡πâ‡∏≠‡∏á‡∏ä‡∏∏‡∏î (Units)
2. üî• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (Maintenance)
3. üî• ‡∏ö‡∏¥‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Billing)
4. üî• ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Payments)
5. üî• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® (Announcements)

### **Medium Priority:**
6. üìä ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (Income/Expenses)
7. üìä ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏•‡∏π‡∏Å‡∏ö‡πâ‡∏≤‡∏ô (Resident Accounts)
8. üìä ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏ (Parcels)
9. üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ (Reports)

### **Low Priority:**
10. üìÑ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (Documents)
11. üìÑ ‡∏™‡∏±‡∏ç‡∏ç‡∏≤ (Contracts)
12. üöó ‡∏à‡∏≠‡∏î‡∏£‡∏ñ (Parking)
13. üèä ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Facilities)

---

## ‚ö° Quick Fix Script

‡∏™‡∏£‡πâ‡∏≤‡∏á script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏∏‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:

```typescript
// scripts/add-project-filtering.ts
import { readdirSync, readFileSync, writeFileSync } from 'fs'
import { join } from 'path'

const PAGES_DIR = 'app/(admin)'
const MODULES = [
  'units', 'maintenance', 'announcements', 'resident-accounts',
  'notifications', 'parcels', 'income-expenses', 'common-fees',
  'billing', 'payments', 'funds', 'budgets', 'accounts-payable',
  'accounts-receivable', 'financial-reports', 'unit-reports',
  'payment-reports', 'maintenance-reports', 'documents',
  'contracts', 'parking', 'facilities', 'visitors'
]

function addProjectFiltering(modulePath: string) {
  const filePath = join(PAGES_DIR, modulePath, 'page.tsx')
  let content = readFileSync(filePath, 'utf-8')
  
  // 1. Add import
  if (!content.includes('useProjectContext')) {
    content = content.replace(
      'import { getCurrentUser }',
      'import { getCurrentUser }\nimport { useProjectContext } from "@/lib/contexts/project-context"'
    )
  }
  
  // 2. Add hook
  if (!content.includes('useProjectContext()')) {
    content = content.replace(
      'const currentUser = getCurrentUser()',
      'const currentUser = getCurrentUser()\n  const { selectedProjectId, selectedProject } = useProjectContext()'
    )
  }
  
  // 3. Add filtering logic
  // ... (pattern matching for filter insertion)
  
  writeFileSync(filePath, content)
}

// Run for all modules
MODULES.forEach(module => addProjectFiltering(module))
```

---

## üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏•:

‚úÖ **Company Admin/Project Admin:**
- ‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‚Üí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô

‚úÖ **Super Admin:**
- ‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á)
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£

‚úÖ **Security:**
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
- ‡πÑ‡∏°‡πà‡∏°‡∏µ data leak
- Audit trail ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

---

## üöÄ Next Steps

### **Phase 1: Core Modules (‡πÅ‡∏Å‡πâ‡∏Å‡πà‡∏≠‡∏ô)**
```bash
1. ‡∏´‡πâ‡∏≠‡∏á‡∏ä‡∏∏‡∏î (Units)
2. ‡∏á‡∏≤‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (Maintenance)
3. ‡∏ö‡∏¥‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Billing)
4. ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Payments)
```

### **Phase 2: Financial Modules**
```bash
5. ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
6. ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á
7. ‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô
8. ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
```

### **Phase 3: Reports & Others**
```bash
9. ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
10. ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ
```

---

## üìö Example Implementation

### **Pattern A: Client-side Filtering**

```tsx
const loadData = async () => {
  const result = await getModuleData(currentUserId)
  
  if (result.success) {
    let data = result.data || []
    
    // Filter by project
    if (selectedProjectId && currentUser.role !== 'super_admin') {
      data = data.filter(item => item.project_id === selectedProjectId)
    }
    
    setData(data)
  }
}

useEffect(() => {
  loadData()
}, [selectedProjectId])
```

### **Pattern B: Server-side Filtering (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)**

```typescript
// Server Action
export async function getModuleData(userId: string, projectId?: string) {
  let query = supabase.from('table').select('*')
  
  // Add project filter
  if (projectId) {
    query = query.eq('project_id', projectId)
  }
  
  const { data } = await query
  return { data }
}

// Page
const loadData = async () => {
  const result = await getModuleData(
    currentUserId, 
    selectedProjectId  // ‚úÖ Pass to server
  )
  setData(result.data)
}
```

---

## ‚úÖ Checklist ‡∏ï‡πà‡∏≠‡πÇ‡∏°‡∏î‡∏π‡∏•

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏• ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥:

- [ ] Import `useProjectContext`
- [ ] ‡πÉ‡∏ä‡πâ `selectedProjectId` ‡πÅ‡∏•‡∏∞ `selectedProject`
- [ ] ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° `selectedProjectId`
- [ ] Reload ‡πÄ‡∏°‡∏∑‡πà‡∏≠ `selectedProjectId` ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° `project_id` ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
- [ ] ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ database ‡∏°‡∏µ column `project_id`
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° index `idx_[table]_project_id`
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö Super Admin (‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á)
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö Company Admin (‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏Ñ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö Project Admin (‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏Ñ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)

---

## üéä Expected Result

‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏•:

```
Login as Company Admin (assigned to P1, P2)
  ‚Üì
Select Project P1
  ‚Üì
Dashboard: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á P1
Units: ‡∏´‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á P1
Maintenance: ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á P1
Billing: ‡∏ö‡∏¥‡∏•‡∏Ç‡∏≠‡∏á P1
Payments: ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏Ç‡∏≠‡∏á P1
... (‡∏ó‡∏∏‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° P1)
  ‚Üì
Switch to P2 (Sidebar)
  ‚Üì
‡∏ó‡∏∏‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á P2 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚úÖ
```

**‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! üîê**

