# การแก้ไขปัญหาการเลือกเลขห้องในระบบพัสดุ

## ปัญหาที่พบ
ไม่สามารถเลือกเลขห้องได้ในหน้าจอ "รับพัสดุเข้า" ทำให้ไม่สามารถบันทึกรายการได้

## สาเหตุที่เป็นไปได้
1. ตาราง `units` ไม่มีข้อมูล
2. ฟังก์ชัน `getUnitsFromDB` ไม่ทำงานถูกต้อง
3. การเชื่อมต่อฐานข้อมูลมีปัญหา

## การแก้ไขที่ทำแล้ว

### 1. เพิ่ม Debug Logs
- เพิ่ม `console.log` ในฟังก์ชัน `loadData`
- แสดงข้อความเมื่อไม่สามารถโหลดข้อมูลห้องได้

### 2. แก้ไขฟังก์ชัน getUnitsFromDB
- เปลี่ยนจาก throw error เป็น return object ที่มี `success` property
- เพิ่ม error handling ที่ดีขึ้น

### 3. เพิ่มการแสดงสถานะ
- แสดงข้อความ "กำลังโหลด..." เมื่อกำลังโหลดข้อมูล
- แสดงข้อความ "ไม่มีข้อมูลห้อง" เมื่อไม่พบข้อมูล
- เพิ่มข้อความแจ้งเตือนสีแดงเมื่อไม่สามารถโหลดข้อมูลได้

### 4. เพิ่มปุ่มทดสอบและรีเฟรช
- ปุ่ม "ทดสอบห้อง" เพื่อทดสอบการเข้าถึงตาราง units
- ปุ่ม "รีเฟรชข้อมูล" ใน Dialog เพื่อโหลดข้อมูลใหม่

## วิธีทดสอบและแก้ไข

### ขั้นตอนที่ 1: ตรวจสอบ Console
1. เปิด Developer Tools (F12)
2. ไปที่ Console tab
3. รีเฟรชหน้า "จัดการพัสดุ"
4. ดูข้อความ debug logs

### ขั้นตอนที่ 2: ทดสอบการเข้าถึงตาราง
1. คลิกปุ่ม "ทดสอบห้อง"
2. ดูผลลัพธ์ใน Toast notification
3. ตรวจสอบ Console logs

### ขั้นตอนที่ 3: ตรวจสอบฐานข้อมูล
หากยังมีปัญหา ให้ตรวจสอบ:
1. ตาราง `units` มีข้อมูลหรือไม่
2. RLS policies ของตาราง `units` ถูกต้องหรือไม่
3. การเชื่อมต่อ Supabase ทำงานปกติหรือไม่

## ไฟล์ที่แก้ไข
- `app/(admin)/parcels/page.tsx` - เพิ่ม debug logs และ error handling
- `lib/supabase/actions.ts` - แก้ไขฟังก์ชัน getUnitsFromDB
- `lib/supabase/test-units.ts` - สร้างฟังก์ชันทดสอบ

## ผลลัพธ์ที่คาดหวัง
หลังจากแก้ไขแล้ว:
- สามารถเลือกเลขห้องได้ในหน้าจอ "รับพัสดุเข้า"
- แสดงข้อความที่ชัดเจนเมื่อมีปัญหา
- มีปุ่มทดสอบและรีเฟรชเพื่อแก้ไขปัญหา
