# üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Username Authentication

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

### 1. Username ‡πÑ‡∏°‡πà‡∏û‡∏ö
```
[signInWithUsername] Username not found: AD222
Error: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
```

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á username mapping ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á `username_mapping`

### 2. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** ‡∏´‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô "pending"

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ô SQL Script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á `username_mapping`

## ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏£‡∏±‡∏ô SQL Script
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Supabase SQL Editor**
2. ‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå `scripts/151_create_username_mapping.sql`
3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á `username_mapping`

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏™‡∏£‡πâ‡∏≤‡∏á Username Mapping ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏Å‡πà‡∏≤
‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á mapping ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á:

```sql
-- ‡∏´‡∏≤ auth user ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
SELECT 
  u.id as unit_id,
  u.unit_number,
  u.user_id as auth_user_id,
  u.owner_email
FROM units u
WHERE u.user_id IS NOT NULL;

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á username mapping (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà username ‡πÅ‡∏•‡∏∞ auth_user_id)
INSERT INTO username_mapping (username, auth_user_id, unit_id)
VALUES ('AD222', 'auth-user-id-here', 'unit-id-here');
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ login
2. ‡∏Å‡∏£‡∏≠‡∏Å username: `AD222`
3. ‡∏Å‡∏£‡∏≠‡∏Å password
4. ‡∏Å‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö

## ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏Å‡πà‡∏≤:
```
Username: AD222
‚Üí ‡πÄ‡∏ä‡πá‡∏Ñ username_mapping
‚Üí ‡πÑ‡∏°‡πà‡∏û‡∏ö (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á)
‚Üí Error: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
```

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà:
```
‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏¥‡∏ç
‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á Supabase Auth user
‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á username_mapping ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
‚Üí Login ‡∏î‡πâ‡∏ß‡∏¢ username ‡πÑ‡∏î‡πâ
```

## Troubleshooting

### ‡∏ñ‡πâ‡∏≤ Username ‡πÑ‡∏°‡πà‡∏û‡∏ö:
1. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á username_mapping:**
   ```sql
   SELECT * FROM username_mapping WHERE username = 'AD222';
   ```

2. **‡∏™‡∏£‡πâ‡∏≤‡∏á mapping ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏Å‡πà‡∏≤:**
   ```sql
   INSERT INTO username_mapping (username, auth_user_id, unit_id)
   VALUES ('AD222', 'auth-user-id', 'unit-id');
   ```

### ‡∏ñ‡πâ‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô:
1. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á invitations:**
   ```sql
   SELECT * FROM invitations WHERE unit_id = 'unit-id' ORDER BY created_at DESC;
   ```

2. **‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á:**
   ```sql
   UPDATE invitations 
   SET status = 'used', used_at = NOW() 
   WHERE code = 'invitation-code';
   ```

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Username Mapping:
```sql
-- ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• unit ‡πÅ‡∏•‡∏∞ auth user
SELECT 
  u.id as unit_id,
  u.unit_number,
  u.user_id as auth_user_id
FROM units u
WHERE u.unit_number = 'AD222';

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á mapping (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á)
INSERT INTO username_mapping (username, auth_user_id, unit_id)
VALUES ('AD222', 'actual-auth-user-id', 'actual-unit-id');
```

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login:
```
Username: AD222
Password: 12345678
‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ username_mapping
‚Üí ‡∏´‡∏≤ auth_user_id
‚Üí ‡πÉ‡∏ä‡πâ Supabase Auth
‚Üí Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
```

## ‡∏™‡∏£‡∏∏‡∏õ

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å:** ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ô SQL Script ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á username mapping

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏£‡∏±‡∏ô SQL Script
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á mapping ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏Å‡πà‡∏≤
3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö login

**‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà:** ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á mapping ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
