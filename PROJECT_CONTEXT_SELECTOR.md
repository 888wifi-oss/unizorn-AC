# Project Context Selector - ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£

## üéØ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡∏£‡∏∞‡∏ö‡∏ö Project Context Selector ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Super Admin ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Login ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

---

## ‚ú® Features

### **1. Project Selection Modal (‡∏´‡∏•‡∏±‡∏á Login)**
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏´‡πâ Company Admin ‡πÅ‡∏•‡∏∞ Project Admin
- ‚úÖ Super Admin ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á)
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á Grid ‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á
- ‚úÖ Auto-select ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó, ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó, ‡∏¢‡∏π‡∏ô‡∏¥‡∏ï)

### **2. Project Selector in Sidebar**
- ‚úÖ Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Sidebar
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
- ‚úÖ ‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠
- ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô localStorage

### **3. Auto Filtering**
- ‚úÖ ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
- ‚úÖ Companies - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
- ‚úÖ Projects - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
- ‚úÖ Users - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
- ‚úÖ User Groups - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£

---

## üé® UI Flow

### **Flow 1: Login ‚Üí Select Project**

```
1. Login ‡∏î‡πâ‡∏ß‡∏¢ svs@email.com (Company Admin)
   ‚Üì
2. Modal ‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£"
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ   üè¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£  ‚îÇ
   ‚îÇ   ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡∏©‡πå‡∏î‡∏µ ‚îÇ
   ‚îÇ   [Company Admin]                  ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‚îÇ
   ‚îÇ                                    ‚îÇ
   ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
   ‚îÇ ‚îÇ Project 1‚îÇ  ‚îÇ Project 2‚îÇ       ‚îÇ
   ‚îÇ ‚îÇ ABC Corp ‚îÇ  ‚îÇ ABC Corp ‚îÇ       ‚îÇ
   ‚îÇ ‚îÇ condo    ‚îÇ  ‚îÇ apartment‚îÇ       ‚îÇ
   ‚îÇ ‚îÇ 120 ‡∏¢‡∏π‡∏ô‡∏¥‡∏ï‚îÇ  ‚îÇ 250 ‡∏¢‡∏π‡∏ô‡∏¥‡∏ï‚îÇ       ‚îÇ
   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
   ‚îÇ                                    ‚îÇ
   ‚îÇ üí° ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ‚Üì
3. ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Project 1"
   ‚Üì
4. Modal ‡∏õ‡∏¥‡∏î ‚Üí ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
   ‚Üì
5. Sidebar ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
6. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° Project 1
```

### **Flow 2: Change Project**

```
1. ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ Project 1
2. Sidebar ‚Üí Dropdown "‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Project 2"
   ‚Üì
4. ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î reload
5. ‚úÖ ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° Project 2
```

---

## üîÑ Technical Implementation

### **1. Project Context**

```typescript
// lib/contexts/project-context.tsx
export const ProjectContextProvider = ({ children }) => {
  const [selectedProjectId, setSelectedProjectId] = useState(null)
  const [availableProjects, setAvailableProjects] = useState([])
  
  useEffect(() => {
    // Load projects user can access
    loadProjects()
  }, [])
  
  useEffect(() => {
    // Save to localStorage
    localStorage.setItem('selected_project_id', selectedProjectId)
  }, [selectedProjectId])
  
  return (
    <ProjectContext.Provider value={{
      selectedProjectId,
      selectedProject,
      availableProjects,
      setSelectedProjectId
    }}>
      {children}
    </ProjectContext.Provider>
  )
}
```

### **2. Project Selector Modal**

```typescript
// components/project-selector.tsx
export function ProjectSelector() {
  const { selectedProjectId, availableProjects, setSelectedProjectId } = useProjectContext()
  const currentUser = getCurrentUser()
  
  // Super Admin doesn't need to select
  if (currentUser.role === 'super_admin') {
    return null
  }
  
  // Already selected
  if (selectedProjectId) {
    return null
  }
  
  // Show modal
  return (
    <Modal>
      <ProjectGrid 
        projects={availableProjects}
        onSelect={setSelectedProjectId}
      />
    </Modal>
  )
}
```

### **3. Sidebar Project Selector**

```typescript
// components/protected-sidebar.tsx
export function ProtectedSidebar() {
  const { selectedProject, availableProjects, setSelectedProjectId } = useProjectContext()
  
  return (
    <Sidebar>
      {/* Project Selector */}
      {currentUser.role !== 'super_admin' && (
        <Select value={selectedProject?.id} onChange={setSelectedProjectId}>
          {availableProjects.map(project => (
            <SelectItem value={project.id}>
              {project.name}
            </SelectItem>
          ))}
        </Select>
      )}
      
      {/* Menus */}
      <nav>...</nav>
    </Sidebar>
  )
}
```

### **4. Data Filtering in Pages**

```typescript
// app/(admin)/user-management/page.tsx
export default function UserManagementPage() {
  const { selectedProjectId, selectedProject } = useProjectContext()
  
  const loadData = async () => {
    // Get all data
    const users = await getUsers(currentUserId)
    const companies = await getCompanies(currentUserId)
    const projects = await getProjects(currentUserId)
    
    // Filter by selected project (for non-Super Admin)
    if (selectedProjectId && currentUser.role !== 'super_admin') {
      // Filter users in project
      const projectUsers = await getUsersInProject(currentUserId, selectedProjectId)
      filteredUsers = users.filter(u => projectUsers.includes(u.id))
      
      // Filter to company of selected project
      filteredCompanies = companies.filter(c => c.id === selectedProject.company_id)
      
      // Filter to selected project only
      filteredProjects = projects.filter(p => p.id === selectedProjectId)
    }
    
    setUsers(filteredUsers)
    setCompanies(filteredCompanies)
    setProjects(filteredProjects)
  }
  
  // Reload when project changes
  useEffect(() => {
    loadData()
  }, [selectedProjectId])
}
```

---

## üìä ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

### **Scenario: svs@email.com (Company Admin)**

#### **Step 1: Login**
```
1. Login as svs@email.com
2. Modal ‡πÅ‡∏™‡∏î‡∏á:
   - Project A1 (ABC Property)
   - Project A2 (ABC Property)
   - Project A3 (ABC Property)
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Project A1"
```

#### **Step 2: ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ**
```
Data Loaded:
- Companies: ABC Property only ‚úÖ
- Projects: Project A1 only ‚úÖ
- Users: Users in Project A1 only ‚úÖ

NOT showing:
- XYZ Developer ‚ùå
- Project B1 ‚ùå
- Users in other projects ‚ùå
```

#### **Step 3: ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**
```
Project Selector:
- Options: Project A1 ‚úÖ (pre-selected from context)

Data:
- Groups: Groups in Project A1 only ‚úÖ
- Users: Users in Project A1 only ‚úÖ
```

#### **Step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£**
```
1. Sidebar ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Project A2"
2. ‚úÖ Data reload ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
3. ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á Project A2
4. ‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Project A1 ‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ
```

---

## üöÄ Benefits

### **1. Clear Scope**
‚úÖ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡πâ‡∏ä‡∏±‡∏î‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏î  
‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏ö‡∏™‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£  

### **2. Data Security**
‚úÖ ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î  
‚úÖ ‡πÅ‡∏¢‡∏Å Scope ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô  
‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Cross-Project data leak  

### **3. Better UX**
‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‚Üí ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥  
‚úÖ ‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏≤‡∏¢ (Sidebar dropdown)  
‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (localStorage)  

### **4. Performance**
‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)  
‚úÖ Query ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô  

---

## üìÅ Files Created/Updated

### **New:**
1. `lib/contexts/project-context.tsx` - Project Context Provider
2. `components/project-selector.tsx` - Project Selection Modal
3. `PROJECT_CONTEXT_SELECTOR.md` - ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ

### **Updated:**
4. `components/protected-sidebar.tsx` - ‡πÄ‡∏û‡∏¥‡πà‡∏° Project Selector
5. `app/(admin)/layout.tsx` - ‡πÄ‡∏û‡∏¥‡πà‡∏° ProjectContextProvider
6. `app/(admin)/user-management/page.tsx` - ‡∏Å‡∏£‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ context
7. `app/(admin)/projects/page.tsx` - ‡∏Å‡∏£‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ context
8. `app/(admin)/user-groups/page.tsx` - sync ‡∏Å‡∏±‡∏ö context
9. `lib/actions/user-role-actions.ts` - ‡πÄ‡∏û‡∏¥‡πà‡∏° getUsersInProject()
10. `lib/actions/company-actions.ts` - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
11. `lib/contexts/permission-context.tsx` - userId optional

---

## üß™ Testing

### **Test 1: First Login (Company Admin)**
```
1. Login as svs@email.com
2. ‚úÖ Modal "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£" ‡πÅ‡∏™‡∏î‡∏á
3. ‚úÖ ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
4. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
5. ‚úÖ Modal ‡∏õ‡∏¥‡∏î
6. ‚úÖ Sidebar ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
```

### **Test 2: Data Filtering**
```
1. ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ Project A1
2. ‡πÄ‡∏Ç‡πâ‡∏≤ "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå"
   ‚Üí ‚úÖ ‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏Ñ‡πà users ‡πÉ‡∏ô Project A1
   ‚Üí ‚úÖ dropdown ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà ABC Property
   ‚Üí ‚úÖ dropdown ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà Project A1

3. ‡πÄ‡∏Ç‡πâ‡∏≤ "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
   ‚Üí ‚úÖ dropdown ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ pre-select ‡πÄ‡∏õ‡πá‡∏ô Project A1
   ‚Üí ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô Project A1

4. ‡πÄ‡∏Ç‡πâ‡∏≤ "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"
   ‚Üí ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà Project A1
```

### **Test 3: Switch Project**
```
1. ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Project A1
2. Sidebar ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Project A2"
3. ‚úÖ ‡∏´‡∏ô‡πâ‡∏≤ reload
4. ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á Project A2
5. ‚úÖ Users, Companies, Projects ‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
```

### **Test 4: Super Admin (No Selection)**
```
1. Login as Super Admin
2. ‚ùå ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
3. ‚ùå Sidebar ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á Project Selector
4. ‚úÖ ‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á)
```

### **Test 5: No Projects**
```
1. Login as user ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
2. ‚úÖ Modal ‡πÅ‡∏™‡∏î‡∏á "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ"
3. ‚úÖ ‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Super Admin
4. ‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ
```

---

## üîÑ Data Flow

```
User Login (svs@email.com)
  ‚Üì
Load Available Projects
  ‚Üí getUserAccessibleProjects(userId)
  ‚Üí Result: [P1, P2, P3]
  ‚Üì
Show Project Selector Modal
  ‚Üí User ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å P1
  ‚Üì
Save to Context + localStorage
  ‚Üí selectedProjectId = P1
  ‚Üì
All Pages Filter by P1
  ‚îú‚îÄ Companies: filter by P1's company
  ‚îú‚îÄ Projects: show only P1
  ‚îú‚îÄ Users: users in P1
  ‚îî‚îÄ Groups: groups in P1
  ‚Üì
User Switches to P2 (Sidebar)
  ‚Üì
Context Updates
  ‚Üí selectedProjectId = P2
  ‚Üì
All Pages Re-filter by P2
```

---

## üíæ localStorage

```typescript
// Keys stored
localStorage.setItem('selected_project_id', projectId)
localStorage.setItem('current_user', JSON.stringify(user))

// On load
const savedProjectId = localStorage.getItem('selected_project_id')
if (savedProjectId && isProjectAccessible(savedProjectId)) {
  setSelectedProjectId(savedProjectId)
}
```

---

## ‚ö†Ô∏è Edge Cases

### **Case 1: Project Access Revoked**
```
User ‡∏°‡∏µ access ‡∏ñ‡∏π‡∏Å‡∏ñ‡∏≠‡∏ô
‚Üí localStorage ‡∏°‡∏µ old project ID
‚Üí ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: project still in availableProjects?
‚Üí ‚ùå ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‚Üí clear ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà
```

### **Case 2: Single Project**
```
User ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà 1 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
‚Üí ‚úÖ Auto-select ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á Modal
‚Üí ‚úÖ ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤ dashboard ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
```

### **Case 3: Multi-Company**
```
User ‡πÄ‡∏õ‡πá‡∏ô Company Admin ‡∏´‡∏•‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
‚Üí ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•
‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ
‚Üí ‚úÖ ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡πâ‡∏ô
```

---

## ‚úÖ Summary

‡∏£‡∏∞‡∏ö‡∏ö Project Context Selector ‡∏ó‡∏≥‡πÉ‡∏´‡πâ:

‚úÖ **‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô** - Scope ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô  
‚úÖ **‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥** - ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤ sync ‡∏Å‡∏±‡∏ô  
‚úÖ **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Data Leak** - ‡πÅ‡∏¢‡∏Å Scope ‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î  
‚úÖ **UX ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô** - ‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏≤‡∏¢  
‚úÖ **Performance ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô** - ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á  

**‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢! üéä**

