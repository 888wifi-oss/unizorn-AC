-- Create Chart of Accounts table
CREATE TABLE IF NOT EXISTS chart_of_accounts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  account_code VARCHAR(10) NOT NULL UNIQUE,
  account_name TEXT NOT NULL,
  account_type VARCHAR(20) NOT NULL CHECK (account_type IN ('asset', 'liability', 'equity', 'revenue', 'expense')),
  parent_code VARCHAR(10),
  level INTEGER NOT NULL DEFAULT 1,
  is_active BOOLEAN DEFAULT true,
  description TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create index for faster queries
CREATE INDEX idx_coa_account_code ON chart_of_accounts(account_code);
CREATE INDEX idx_coa_account_type ON chart_of_accounts(account_type);
CREATE INDEX idx_coa_parent_code ON chart_of_accounts(parent_code);

-- Insert Chart of Accounts Master Data for Condominium

-- 1. ASSETS (สินทรัพย์) - 1xxx
INSERT INTO chart_of_accounts (account_code, account_name, account_type, level, description) VALUES
('1000', 'สินทรัพย์', 'asset', 1, 'สินทรัพย์ทั้งหมด'),
('1100', 'สินทรัพย์หมุนเวียน', 'asset', 2, 'สินทรัพย์ที่สามารถเปลี่ยนเป็นเงินสดได้ภายใน 1 ปี'),
('1101', 'เงินสด', 'asset', 3, 'เงินสดในมือ'),
('1102', 'เงินฝากธนาคาร - กระแสรายวัน', 'asset', 3, 'บัญชีกระแสรายวัน'),
('1103', 'เงินฝากธนาคาร - ออมทรัพย์', 'asset', 3, 'บัญชีออมทรัพย์'),
('1104', 'เงินฝากธนาคาร - ประจำ', 'asset', 3, 'บัญชีเงินฝากประจำ'),
('1110', 'ลูกหนี้ค่าส่วนกลาง', 'asset', 3, 'ค่าส่วนกลางค้างชำระ'),
('1111', 'ลูกหนี้ค่าน้ำ', 'asset', 3, 'ค่าน้ำค้างชำระ'),
('1112', 'ลูกหนี้ค่าไฟฟ้า', 'asset', 3, 'ค่าไฟฟ้าค้างชำระ'),
('1113', 'ลูกหนี้ค่าที่จอดรถ', 'asset', 3, 'ค่าที่จอดรถค้างชำระ'),
('1120', 'วัสดุสิ้นเปลือง', 'asset', 3, 'วัสดุสำนักงานและวัสดุทำความสะอาด'),
('1200', 'สินทรัพย์ไม่หมุนเวียน', 'asset', 2, 'สินทรัพย์ระยะยาว'),
('1201', 'อุปกรณ์และเครื่องมือ', 'asset', 3, 'อุปกรณ์ต่างๆ ของนิติบุคคล'),
('1202', 'เครื่องใช้สำนักงาน', 'asset', 3, 'โต๊ะ เก้าอี้ ตู้เอกสาร'),
('1203', 'ส่วนปรับปรุงอาคาร', 'asset', 3, 'การปรับปรุงส่วนกลาง'),
('1204', 'ค่าเสื่อมราคาสะสม', 'asset', 3, 'ค่าเสื่อมราคาสินทรัพย์');

-- 2. LIABILITIES (หนี้สิน) - 2xxx
INSERT INTO chart_of_accounts (account_code, account_name, account_type, level, description) VALUES
('2000', 'หนี้สิน', 'liability', 1, 'หนี้สินทั้งหมด'),
('2100', 'หนี้สินหมุนเวียน', 'liability', 2, 'หนี้สินที่ต้องชำระภายใน 1 ปี'),
('2101', 'เจ้าหนี้การค้า', 'liability', 3, 'เจ้าหนี้ค่าสินค้าและบริการ'),
('2102', 'ค่าใช้จ่ายค้างจ่าย', 'liability', 3, 'ค่าใช้จ่ายที่ยังไม่ได้จ่าย'),
('2103', 'เงินมัดจำรับ', 'liability', 3, 'เงินมัดจำจากเจ้าของห้องชุด'),
('2104', 'ภาษีหัก ณ ที่จ่ายค้างจ่าย', 'liability', 3, 'ภาษีที่หักไว้ยังไม่นำส่ง'),
('2105', 'ประกันสังคมค้างจ่าย', 'liability', 3, 'เงินประกันสังคมค้างนำส่ง'),
('2200', 'หนี้สินไม่หมุนเวียน', 'liability', 2, 'หนี้สินระยะยาว'),
('2201', 'เงินกู้ยืมระยะยาว', 'liability', 3, 'เงินกู้จากสถาบันการเงิน');

-- 3. EQUITY/FUND (ทุน/กองทุน) - 3xxx
INSERT INTO chart_of_accounts (account_code, account_name, account_type, level, description) VALUES
('3000', 'ทุน/กองทุน', 'equity', 1, 'ทุนและกองทุนทั้งหมด'),
('3100', 'กองทุนสำรอง', 'equity', 2, 'กองทุนสำรองตามกฎหมาย'),
('3101', 'กองทุนสำรองเลี้ยงชีพ', 'equity', 3, 'กองทุนสำรองระยะยาว'),
('3102', 'กองทุนซ่อมแซมใหญ่', 'equity', 3, 'กองทุนสำหรับซ่อมแซมครั้งใหญ่'),
('3200', 'กำไร(ขาดทุน)สะสม', 'equity', 2, 'กำไรหรือขาดทุนสะสม'),
('3201', 'กำไร(ขาดทุน)ปีปัจจุบัน', 'equity', 3, 'ผลการดำเนินงานปีปัจจุบัน');

-- 4. REVENUE (รายได้) - 4xxx
INSERT INTO chart_of_accounts (account_code, account_name, account_type, level, description) VALUES
('4000', 'รายได้', 'revenue', 1, 'รายได้ทั้งหมด'),
('4100', 'รายได้จากการดำเนินงาน', 'revenue', 2, 'รายได้หลักจากการดำเนินงาน'),
('4101', 'รายได้ค่าส่วนกลาง', 'revenue', 3, 'ค่าส่วนกลางรายเดือน'),
('4102', 'รายได้ค่าน้ำ', 'revenue', 3, 'ค่าน้ำประปา'),
('4103', 'รายได้ค่าไฟฟ้า', 'revenue', 3, 'ค่าไฟฟ้า'),
('4104', 'รายได้ค่าที่จอดรถ', 'revenue', 3, 'ค่าที่จอดรถรายเดือน'),
('4105', 'รายได้ค่าปรับชำระล่าช้า', 'revenue', 3, 'ค่าปรับกรณีชำระเงินล่าช้า'),
('4200', 'รายได้อื่น', 'revenue', 2, 'รายได้นอกเหนือจากการดำเนินงาน'),
('4201', 'รายได้ดอกเบี้ยรับ', 'revenue', 3, 'ดอกเบี้ยจากเงินฝากธนาคาร'),
('4202', 'รายได้ค่าเช่าพื้นที่', 'revenue', 3, 'ค่าเช่าพื้นที่โฆษณา'),
('4203', 'รายได้เบ็ดเตล็ด', 'revenue', 3, 'รายได้อื่นๆ');

-- 5. EXPENSES (ค่าใช้จ่าย) - 5xxx
INSERT INTO chart_of_accounts (account_code, account_name, account_type, level, description) VALUES
('5000', 'ค่าใช้จ่าย', 'expense', 1, 'ค่าใช้จ่ายทั้งหมด'),
('5100', 'ค่าใช้จ่ายบุคลากร', 'expense', 2, 'ค่าใช้จ่ายเกี่ยวกับพนักงาน'),
('5101', 'เงินเดือนพนักงาน', 'expense', 3, 'เงินเดือนประจำ'),
('5102', 'ค่าล่วงเวลา', 'expense', 3, 'ค่าทำงานล่วงเวลา'),
('5103', 'โบนัสพนักงาน', 'expense', 3, 'โบนัสประจำปี'),
('5104', 'เงินสมทบประกันสังคม', 'expense', 3, 'ส่วนที่นายจ้างจ่าย'),
('5105', 'เครื่องแบบพนักงาน', 'expense', 3, 'ค่าเครื่องแบบ'),
('5106', 'สวัสดิการพนักงาน', 'expense', 3, 'สวัสดิการต่างๆ'),
('5200', 'ค่าใช้จ่ายสาธารณูปโภค', 'expense', 2, 'ค่าน้ำ ค่าไฟ ส่วนกลาง'),
('5201', 'ค่าไฟฟ้าส่วนกลาง', 'expense', 3, 'ค่าไฟฟ้าส่วนกลาง'),
('5202', 'ค่าน้ำประปาส่วนกลาง', 'expense', 3, 'ค่าน้ำส่วนกลาง'),
('5203', 'ค่าโทรศัพท์', 'expense', 3, 'ค่าโทรศัพท์สำนักงาน'),
('5204', 'ค่าอินเทอร์เน็ต', 'expense', 3, 'ค่าอินเทอร์เน็ต'),
('5300', 'ค่าบำรุงรักษาและซ่อมแซม', 'expense', 2, 'ค่าซ่อมแซมและบำรุงรักษา'),
('5301', 'ค่าซ่อมแซมอาคาร', 'expense', 3, 'ซ่อมแซมส่วนกลาง'),
('5302', 'ค่าบำรุงรักษาลิฟต์', 'expense', 3, 'ค่าบำรุงลิฟต์'),
('5303', 'ค่าบำรุงรักษาปั๊มน้ำ', 'expense', 3, 'ค่าบำรุงระบบน้ำ'),
('5304', 'ค่าบำรุงรักษาระบบไฟฟ้า', 'expense', 3, 'ค่าบำรุงระบบไฟฟ้า'),
('5305', 'ค่าบำรุงรักษาระบบรักษาความปลอดภัย', 'expense', 3, 'ค่าบำรุงกล้องวงจรปิด'),
('5306', 'ค่าบำรุงรักษาสระว่ายน้ำ', 'expense', 3, 'ค่าบำรุงสระว่ายน้ำ'),
('5307', 'ค่าบำรุงรักษาฟิตเนส', 'expense', 3, 'ค่าบำรุงห้องฟิตเนส'),
('5400', 'ค่าทำความสะอาด', 'expense', 2, 'ค่าใช้จ่ายทำความสะอาด'),
('5401', 'ค่าจ้างทำความสะอาด', 'expense', 3, 'ค่าจ้างบริษัททำความสะอาด'),
('5402', 'ค่าวัสดุทำความสะอาด', 'expense', 3, 'น้ำยา ไม้กวาด ฯลฯ'),
('5403', 'ค่าจัดการขยะ', 'expense', 3, 'ค่าจัดการขยะ'),
('5500', 'ค่ารักษาความปลอดภัย', 'expense', 2, 'ค่าใช้จ่ายรักษาความปลอดภัย'),
('5501', 'ค่าจ้างรักษาความปลอดภัย', 'expense', 3, 'ค่าจ้างยาม'),
('5502', 'ค่าอุปกรณ์รักษาความปลอดภัย', 'expense', 3, 'อุปกรณ์ต่างๆ'),
('5600', 'ค่าใช้จ่ายสำนักงาน', 'expense', 2, 'ค่าใช้จ่ายบริหารสำนักงาน'),
('5601', 'ค่าเครื่องเขียนแบบพิมพ์', 'expense', 3, 'เครื่องเขียนและแบบพิมพ์'),
('5602', 'ค่าไปรษณีย์', 'expense', 3, 'ค่าส่งเอกสาร'),
('5603', 'ค่าธรรมเนียมธนาคาร', 'expense', 3, 'ค่าธรรมเนียมต่างๆ'),
('5604', 'ค่าที่ปรึกษา', 'expense', 3, 'ค่าที่ปรึกษากฎหมาย บัญชี'),
('5605', 'ค่าตรวจสอบบัญชี', 'expense', 3, 'ค่าผู้สอบบัญชี'),
('5700', 'ค่าประกันภัย', 'expense', 2, 'ค่าเบี้ยประกันภัยต่างๆ'),
('5701', 'ค่าประกันอัคคีภัย', 'expense', 3, 'ประกันอัคคีภัยอาคาร'),
('5702', 'ค่าประกันภัยทรัพย์สิน', 'expense', 3, 'ประกันทรัพย์สิน'),
('5800', 'ค่าภาษีและอากร', 'expense', 2, 'ภาษีและอากรต่างๆ'),
('5801', 'ภาษีโรงเรือนและที่ดิน', 'expense', 3, 'ภาษีโรงเรือน'),
('5802', 'ภาษีป้าย', 'expense', 3, 'ภาษีป้าย'),
('5900', 'ค่าใช้จ่ายอื่น', 'expense', 2, 'ค่าใช้จ่ายอื่นๆ'),
('5901', 'ค่าเสื่อมราคา', 'expense', 3, 'ค่าเสื่อมราคาสินทรัพย์'),
('5902', 'ค่าใช้จ่ายเบ็ดเตล็ด', 'expense', 3, 'ค่าใช้จ่ายอื่นๆ'),
('5903', 'หนี้สูญและหนี้สงสัยจะสูญ', 'expense', 3, 'หนี้ที่เรียกเก็บไม่ได้');

-- Create trigger to update updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_coa_updated_at BEFORE UPDATE ON chart_of_accounts
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
