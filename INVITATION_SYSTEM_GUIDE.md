# р╕гр╕░р╕Ър╕Ър╕кр╣Ир╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н (Invitation System)

## ЁЯУЛ р╕ар╕▓р╕Юр╕гр╕зр╕бр╕гр╕░р╕Ър╕Ъ

р╕гр╕░р╕Ър╕Ър╣Гр╕лр╕бр╣Ир╕Щр╕╡р╣Йр╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Й:
- тЬЕ р╕ер╕╣р╕Бр╕Ър╣Йр╕▓р╕Щр╕кр╕гр╣Йр╕▓р╕З username р╣Бр╕ер╕░ password р╣Ар╕нр╕Зр╣Др╕Фр╣Й
- тЬЕ Email р╣Гр╕Кр╣Йр╣Ар╕Йр╕Юр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
- тЬЕ р╕ер╕Фр╕ар╕▓р╕гр╕░р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Ър╕▒р╕Нр╕Кр╕╡р╕Вр╕нр╕Зр╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░р╕Ър╕Ъ
- тЬЕ р╕кр╣Ир╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╕лр╕гр╕╖р╕нр╕ер╕┤р╕Зр╕Бр╣Мр╣Гр╕лр╣Йр╕ер╕╣р╕Бр╕Ър╣Йр╕▓р╕Щр╕Ьр╣Ир╕▓р╕Щр╕лр╕ер╕▓р╕вр╕Кр╣Ир╕нр╕Зр╕Чр╕▓р╕З

## ЁЯЪА р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░р╕Ър╕Ъ (Admin)

#### 1. р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н

1. р╣Др╕Ыр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓ **"р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Ър╕▒р╕Нр╕Кр╕╡р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й Portal"**
2. р╕лр╕▓р╕лр╣Йр╕нр╕Зр╕Кр╕╕р╕Фр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н
3. р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б **"р╕кр╣Ир╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н"**
4. р╕Бр╕гр╕нр╕Бр╕нр╕╡р╣Ар╕бр╕е (optional) р╣Ар╕Юр╕╖р╣Ир╕нр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Др╕зр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
5. р╕Бр╕Ф **"р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н"**

#### 2. р╕кр╣Ир╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╣Гр╕лр╣Йр╕ер╕╣р╕Бр╕Ър╣Йр╕▓р╕Щ

р╣Ар╕бр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╕кр╕│р╣Ар╕гр╣Зр╕И р╕Ир╕░р╣Др╕Фр╣Й:
- **р╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н** (Invitation Code) - р╣Ар╕Кр╣Ир╕Щ `a1b2c3d4e5f6g7h8`
- **р╕ер╕┤р╕Зр╕Бр╣Мр╣Ар╕Кр╕┤р╕Н** (Invitation Link) - р╣Ар╕Кр╣Ир╕Щ `https://yoursite.com/portal/register?code=a1b2c3d4e5f6g7h8`

р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╣Ир╕Зр╣Гр╕лр╣Йр╕ер╕╣р╕Бр╕Ър╣Йр╕▓р╕Щр╣Др╕Фр╣Й 2 р╕зр╕┤р╕Шр╕╡:

**р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 1: р╕кр╣Ир╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н**
```
р╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н: a1b2c3d4e5f6g7h8
р╣Др╕Ыр╕Чр╕╡р╣И https://yoursite.com/portal/register
```

**р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 2: р╕кр╣Ир╕Зр╕ер╕┤р╕Зр╕Бр╣Мр╣Ар╕Кр╕┤р╕Н**
```
https://yoursite.com/portal/register?code=a1b2c3d4e5f6g7h8
```

### р╕кр╕│р╕лр╕гр╕▒р╕Ър╕ер╕╣р╕Бр╕Ър╣Йр╕▓р╕Щ (Resident)

#### 1. р╕гр╕▒р╕Ър╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н

р╕ер╕╣р╕Бр╕Ър╣Йр╕▓р╕Щр╕Ир╕░р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╕лр╕гр╕╖р╕нр╕ер╕┤р╕Зр╕Бр╣Мр╕Ир╕▓р╕Бр╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░р╕Ър╕Ъ

#### 2. р╣Др╕Ыр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓ Register

- р╕Цр╣Йр╕▓р╣Др╕Фр╣Йр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н: р╣Др╕Ыр╕Чр╕╡р╣И `https://yoursite.com/portal/register` р╣Бр╕ер╣Йр╕зр╕Бр╕гр╕нр╕Бр╕гр╕лр╕▒р╕к
- р╕Цр╣Йр╕▓р╣Др╕Фр╣Йр╕ер╕┤р╕Зр╕Бр╣М: р╕Др╕ер╕┤р╕Бр╕ер╕┤р╕Зр╕Бр╣Мр╣Др╕Фр╣Йр╣Ар╕ер╕в

#### 3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н

р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╣Бр╕ер╕░р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕лр╣Йр╕нр╕Зр╕Кр╕╕р╕Ф

#### 4. р╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕▒р╕Нр╕Кр╕╡

р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е:
- **Username** - р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
- **Email** (optional) - р╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
- **Password** - р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ (р╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 6 р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г)
- **Confirm Password** - р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ

#### 5. р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ

р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕▒р╕Нр╕Кр╕╡р╕кр╕│р╣Ар╕гр╣Зр╕И р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡!

## ЁЯЫая╕П р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╕гр╕░р╕Ър╕Ъ

### 1. р╕гр╕▒р╕Щ SQL Script

```bash
# р╣Др╕Ыр╕Чр╕╡р╣И Supabase SQL Editor
# р╕гр╕▒р╕Щр╣Др╕Яр╕ер╣М: scripts/148_create_invitations_table.sql
```

### 2. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Environment Variables

р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Др╕Яр╕ер╣М `.env.local` р╕бр╕╡:

```env
NEXT_PUBLIC_SUPABASE_URL=your-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
NEXT_PUBLIC_SITE_URL=http://localhost:3000  # р╕кр╕│р╕лр╕гр╕▒р╕Ъ production р╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щ domain р╕Ир╕гр╕┤р╕З
```

### 3. р╕гр╕╡р╕кр╕Хр╕▓р╕гр╣Мр╕Ч Dev Server

```bash
npm run dev
```

## ЁЯУК Database Schema

### Table: invitations

```sql
CREATE TABLE public.invitations (
  id UUID PRIMARY KEY,
  unit_id UUID REFERENCES units(id),
  code VARCHAR(16) UNIQUE NOT NULL,
  email VARCHAR(255),
  status VARCHAR(20) DEFAULT 'pending',  -- pending, used, expired
  expires_at TIMESTAMPTZ NOT NULL,
  used_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  created_by UUID REFERENCES users(id)
);
```

## ЁЯФР Security Features

1. **р╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╕бр╕╡р╕нр╕▓р╕вр╕╕ 7 р╕зр╕▒р╕Щ** - р╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕р╣Бр╕ер╣Йр╕зр╕Хр╣Йр╕нр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕лр╕бр╣И
2. **р╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╣Гр╕Кр╣Йр╣Др╕Фр╣Йр╕Др╕гр╕▒р╣Йр╕Зр╣Ар╕Фр╕╡р╕вр╕з** - р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕▒р╕Нр╕Кр╕╡р╣Бр╕ер╣Йр╕зр╕Ир╕░р╣Гр╕Кр╣Йр╣Др╕бр╣Ир╣Др╕Фр╣Йр╕нр╕╡р╕Б
3. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤** - р╕гр╕░р╕Ър╕Ър╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ validity р╕Вр╕нр╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н
4. **Username р╣Др╕бр╣Ир╕Лр╣Йр╕│** - р╣Гр╕Кр╣Й Supabase Auth р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ username р╕Лр╣Йр╕│

## ЁЯТб р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### р╕кр╣Ир╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╕Ьр╣Ир╕▓р╕Щ LINE

```
р╕кр╕зр╕▒р╕кр╕Фр╕╡р╕Др╣Ир╕░ р╕Др╕╕р╕Ур╣Ар╕Ир╣Йр╕▓р╕Вр╕нр╕Зр╕лр╣Йр╕нр╕З A-101

р╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕▒р╕Нр╕Кр╕╡ Portal:
a1b2c3d4e5f6g7h8

р╕Бр╕гр╕╕р╕Ур╕▓р╣Др╕Ыр╕Чр╕╡р╣И: https://yoursite.com/portal/register
р╕Бр╕гр╕нр╕Бр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕З username р╣Бр╕ер╕░ password

р╕лр╕▓р╕Бр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓ р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕┤р╕Фр╕Хр╣Ир╕нр╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░р╕Ър╕Ъ
```

### р╕кр╣Ир╕Зр╕ер╕┤р╕Зр╕Бр╣Мр╣Ар╕Кр╕┤р╕Нр╕Ьр╣Ир╕▓р╕Щ Email

```
Subject: р╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕▒р╕Нр╕Кр╕╡ Portal

р╣Ар╕гр╕╡р╕вр╕Щ р╕Др╕╕р╕Ур╣Ар╕Ир╣Йр╕▓р╕Вр╕нр╕Зр╕лр╣Йр╕нр╕З A-101

р╕Бр╕гр╕╕р╕Ур╕▓р╕Др╕ер╕┤р╕Бр╕ер╕┤р╕Зр╕Бр╣Мр╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕▒р╕Нр╕Кр╕╡:
https://yoursite.com/portal/register?code=a1b2c3d4e5f6g7h8

р╕ер╕┤р╕Зр╕Бр╣Мр╕Щр╕╡р╣Йр╣Гр╕Кр╣Йр╣Др╕Фр╣Й 7 р╕зр╕▒р╕Щ р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕Др╕ер╕┤р╕Бр╣Бр╕ер╣Йр╕зр╕Ир╕░р╕кр╕гр╣Йр╕▓р╕З username р╣Бр╕ер╕░ password р╣Ар╕нр╕З

р╕Вр╕нр╣Бр╕кр╕Фр╕Зр╕Др╕зр╕▓р╕бр╕Щр╕▒р╕Ър╕Цр╕╖р╕н
р╕Чр╕╡р╕бр╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░р╕Ър╕Ъ
```

## ЁЯОп р╕Вр╣Йр╕нр╕Фр╕╡р╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ър╕Щр╕╡р╣Й

1. **р╕ер╕Фр╕ар╕▓р╕гр╕░р╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕е** - р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕кр╕гр╣Йр╕▓р╕З username/password р╣Гр╕лр╣Йр╕ер╕╣р╕Бр╕Ър╣Йр╕▓р╕Щ
2. **р╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕вр╕кр╕╣р╕З** - р╕ер╕╣р╕Бр╕Ър╣Йр╕▓р╕Щр╕Хр╕▒р╣Йр╕Зр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Ар╕нр╕Зр╣Др╕Фр╣Й
3. **р╕вр╕╖р╕Фр╕лр╕вр╕╕р╣Ир╕Щ** - р╕кр╣Ир╕Зр╣Др╕Фр╣Йр╕лр╕ер╕▓р╕вр╕Кр╣Ир╕нр╕Зр╕Чр╕▓р╕З (LINE, Email, SMS)
4. **р╕кр╕░р╕Фр╕зр╕Б** - р╕кр╣Ир╕Зр╕ер╕┤р╕Зр╕Бр╣Мр╣Др╕Фр╣Йр╣Ар╕ер╕в р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕гр╕нр╕Бр╕гр╕лр╕▒р╕кр╣Ар╕нр╕З
5. **р╕Хр╕┤р╕Фр╕Хр╕▓р╕бр╣Др╕Фр╣Й** - р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б history р╕Вр╕нр╕З invitations

## ЁЯФД Workflow

```
Admin тЖТ р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н тЖТ р╕кр╣Ир╕Зр╣Гр╕лр╣Йр╕ер╕╣р╕Бр╕Ър╣Йр╕▓р╕Щ
                            тЖУ
                       р╕ер╕╣р╕Бр╕Ър╣Йр╕▓р╕Щр╕гр╕▒р╕Ър╕гр╕лр╕▒р╕к
                            тЖУ
                      р╣Др╕Ыр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓ Register
                            тЖУ
                    р╕Бр╕гр╕нр╕Бр╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Н + р╕кр╕гр╣Йр╕▓р╕З username/password
                            тЖУ
                          р╕Ър╕▒р╕Нр╕Кр╕╡р╕Цр╕╣р╕Бр╕кр╕гр╣Йр╕▓р╕З
                            тЖУ
                       р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡
```

## ЁЯУЭ Notes

- Email р╣Др╕бр╣Ир╕Ър╕▒р╕Зр╕Др╕▒р╕Ъ р╣Бр╕Хр╣Ир╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕лр╣Йр╕Бр╕гр╕нр╕Бр╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
- Username р╣Бр╕ер╕░ Password р╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕нр╕Зр╣Др╕Фр╣Йр╕Хр╕▓р╕бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г
- р╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕р╣Гр╕Щ 7 р╕зр╕▒р╕Щ
- р╣Бр╕Хр╣Ир╕ер╕░р╕гр╕лр╕▒р╕кр╣Ар╕Кр╕┤р╕Нр╣Гр╕Кр╣Йр╣Др╕Фр╣Й 1 р╕Др╕гр╕▒р╣Йр╕Зр╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ

